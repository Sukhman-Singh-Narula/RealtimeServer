2025-06-16 11:17:49,060 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:17:49,060 - app.main - INFO - Initializing managers...
2025-06-16 11:17:49,060 - app.main - INFO -   Initializing database manager...
2025-06-16 11:17:49,060 - app.models.database - INFO - Initializing database...
2025-06-16 11:17:49,122 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:17:49,123 - app.models.database - INFO - Database initialization completed
2025-06-16 11:17:49,124 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:17:49,124 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:17:49,124 - app.main - INFO -   Initializing content manager...
2025-06-16 11:17:49,177 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:17:49,178 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:17:49,178 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:17:49,178 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:17:49,178 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:17:49,178 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:17:49,178 - app.main - ERROR -   Failed to initialize managers: 'websocket'
2025-06-16 11:17:49,178 - app.main - ERROR - Startup failed: 'websocket'
2025-06-16 11:21:19,730 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:21:19,730 - app.main - INFO - Initializing managers...
2025-06-16 11:21:19,731 - app.main - INFO -   Initializing database manager...
2025-06-16 11:21:19,731 - app.models.database - INFO - Initializing database...
2025-06-16 11:21:19,773 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:21:19,775 - app.models.database - INFO - Database initialization completed
2025-06-16 11:21:19,775 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:21:19,775 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:21:19,775 - app.main - INFO -   Initializing content manager...
2025-06-16 11:21:19,821 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:21:19,821 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:21:19,821 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:21:19,821 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:21:19,821 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:21:19,821 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:21:19,821 - app.api.websocket_handler - INFO - WebSocketHandler initialized
2025-06-16 11:21:19,821 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 11:21:19,821 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 11:21:19,821 - app.main - INFO -   All managers initialized successfully
2025-06-16 11:21:19,821 - app.main - ERROR - Startup failed: 'APIRouter' object has no attribute 'dependency_overrides'
2025-06-16 11:40:44,233 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:40:44,233 - app.main - INFO - Initializing managers...
2025-06-16 11:40:44,233 - app.main - INFO -   Initializing database manager...
2025-06-16 11:40:44,233 - app.models.database - INFO - Initializing database...
2025-06-16 11:40:44,266 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:40:44,267 - app.models.database - INFO - Database initialization completed
2025-06-16 11:40:44,267 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:40:44,267 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:40:44,267 - app.main - INFO -   Initializing content manager...
2025-06-16 11:40:44,302 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:40:44,302 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:40:44,302 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:40:44,302 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:40:44,303 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:40:44,303 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:40:44,303 - app.api.websocket_handler - INFO - WebSocketHandler initialized
2025-06-16 11:40:44,303 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 11:40:44,303 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 11:40:44,303 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 11:40:44,303 - app.main - INFO -   All managers initialized successfully
2025-06-16 11:40:44,303 - app.main - ERROR - Startup failed: 'APIRouter' object has no attribute 'dependency_overrides'
2025-06-16 11:40:53,804 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:40:53,804 - app.main - INFO - Initializing managers...
2025-06-16 11:40:53,804 - app.main - INFO -   Initializing database manager...
2025-06-16 11:40:53,804 - app.models.database - INFO - Initializing database...
2025-06-16 11:40:53,836 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:40:53,837 - app.models.database - INFO - Database initialization completed
2025-06-16 11:40:53,838 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:40:53,838 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:40:53,838 - app.main - INFO -   Initializing content manager...
2025-06-16 11:40:53,880 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:40:53,880 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:40:53,880 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:40:53,880 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:40:53,880 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:40:53,881 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:40:53,881 - app.api.websocket_handler - INFO - WebSocketHandler initialized
2025-06-16 11:40:53,881 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 11:40:53,881 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 11:40:53,881 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 11:40:53,881 - app.main - INFO -   All managers initialized successfully
2025-06-16 11:40:53,881 - app.main - ERROR - Startup failed: 'APIRouter' object has no attribute 'dependency_overrides'
2025-06-16 11:44:04,972 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:44:04,972 - app.main - INFO - Initializing managers...
2025-06-16 11:44:04,972 - app.main - INFO -   Initializing database manager...
2025-06-16 11:44:04,972 - app.models.database - INFO - Initializing database...
2025-06-16 11:44:05,012 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:44:05,014 - app.models.database - INFO - Database initialization completed
2025-06-16 11:44:05,014 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:44:05,014 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:44:05,014 - app.main - INFO -   Initializing content manager...
2025-06-16 11:44:05,056 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:44:05,056 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:44:05,056 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:44:05,056 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:44:05,056 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:44:05,056 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:44:05,056 - app.api.websocket_handler - INFO - WebSocketHandler initialized
2025-06-16 11:44:05,056 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 11:44:05,056 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 11:44:05,056 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 11:44:05,056 - app.main - INFO -   All managers initialized successfully
2025-06-16 11:44:05,056 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 11:44:05,056 - app.main - INFO -   Including API routers...
2025-06-16 11:44:05,074 - app.main - INFO - System startup complete - ready to accept connections
2025-06-16 11:44:21,684 - app.managers.cache_manager - INFO - Initializing Redis connection...
2025-06-16 11:44:21,820 - app.main - ERROR - Internal server error: 'dict' object is not callable
2025-06-16 11:44:33,569 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 11:44:33,569 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 11:44:33,569 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 11:44:33,599 - app.api.websocket_handler - INFO - User initialized: bb70a4f5-40ad-4c1b-b562-72c714add385 for device TEST_DEVICE_001
2025-06-16 11:44:33,599 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 11:44:36,263 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 11:44:36,264 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 11:44:36,264 - app.api.websocket_handler - INFO - Next episode for TEST_DEVICE_001: Greetings and Family (S1E1)
2025-06-16 11:44:36,264 - app.api.websocket_handler - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:44:36,264 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:44:36,268 - app.managers.realtime_manager - ERROR - Failed to create realtime connection for TEST_DEVICE_001: BaseEventLoop.create_connection() got an unexpected keyword argument 'additional_headers'
2025-06-16 11:44:38,263 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 11:44:38,263 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 11:44:38,263 - app.api.websocket_handler - INFO - Generated choice config for TEST_DEVICE_001 with episode: Greetings and Family
2025-06-16 11:44:38,263 - app.managers.realtime_manager - ERROR - No connection found for TEST_DEVICE_001
2025-06-16 11:44:40,271 - app.api.websocket_handler - ERROR - Error handling connection for TEST_DEVICE_001: 'NoneType' object has no attribute 'session_id'
2025-06-16 11:44:40,271 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 11:44:40,272 - app.api.websocket_handler - INFO - Total conversation time for TEST_DEVICE_001: 0.0 seconds
2025-06-16 11:44:40,272 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 11:44:40,272 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 11:51:27,085 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 11:51:27,085 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 11:51:27,085 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 11:51:27,085 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 11:51:27,085 - app.main - INFO - Shutdown complete
2025-06-16 11:51:30,330 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:51:30,330 - app.main - INFO - Initializing managers...
2025-06-16 11:51:30,330 - app.main - INFO -   Initializing database manager...
2025-06-16 11:51:30,330 - app.models.database - INFO - Initializing database...
2025-06-16 11:51:30,378 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:51:30,379 - app.models.database - INFO - Database initialization completed
2025-06-16 11:51:30,380 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:51:30,380 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:51:30,380 - app.main - INFO -   Initializing content manager...
2025-06-16 11:51:30,424 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:51:30,424 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:51:30,424 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:51:30,424 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:51:30,425 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:51:30,425 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:51:30,425 - app.api.websocket_handler - INFO - WebSocketHandler initialized
2025-06-16 11:51:30,425 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 11:51:30,425 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 11:51:30,425 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 11:51:30,425 - app.main - INFO -   All managers initialized successfully
2025-06-16 11:51:30,425 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 11:51:30,425 - app.main - INFO -   Including API routers...
2025-06-16 11:51:30,447 - app.main - INFO - System startup complete - ready to accept connections
2025-06-16 11:51:30,448 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 11:51:30,449 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 11:51:30,449 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 11:51:30,486 - app.api.websocket_handler - INFO - User initialized: bb70a4f5-40ad-4c1b-b562-72c714add385 for device TEST_DEVICE_001
2025-06-16 11:51:30,486 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 11:51:33,298 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 11:51:33,299 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 11:51:33,299 - app.api.websocket_handler - INFO - Next episode for TEST_DEVICE_001: Greetings and Family (S1E1)
2025-06-16 11:51:33,299 - app.managers.cache_manager - INFO - Initializing Redis connection...
2025-06-16 11:51:33,331 - app.api.websocket_handler - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:51:33,331 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:51:34,802 - app.managers.realtime_manager - INFO - Connected to OpenAI Realtime API for TEST_DEVICE_001
2025-06-16 11:51:34,803 - app.managers.realtime_manager - INFO - Starting OpenAI listener for TEST_DEVICE_001
2025-06-16 11:51:34,803 - app.managers.realtime_manager - ERROR - Error in OpenAI listener for TEST_DEVICE_001: cannot call recv while another coroutine is already waiting for the next message
2025-06-16 11:51:34,803 - app.managers.realtime_manager - INFO - Cleaned up OpenAI connection for TEST_DEVICE_001
2025-06-16 11:51:34,818 - app.managers.realtime_manager - INFO - Session created for TEST_DEVICE_001: sess_BixVkYwZompw6gO9GIZbV
2025-06-16 11:51:36,829 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 11:51:36,829 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 11:51:36,829 - app.api.websocket_handler - INFO - Generated choice config for TEST_DEVICE_001 with episode: Greetings and Family
2025-06-16 11:51:36,829 - app.managers.realtime_manager - ERROR - No connection found for TEST_DEVICE_001
2025-06-16 11:51:38,876 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:51:38,876 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:51:38,876 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:51:38,876 - app.managers.realtime_manager - INFO - Response creation requested for TEST_DEVICE_001
2025-06-16 11:51:38,876 - app.managers.realtime_manager - INFO - Conversation started for TEST_DEVICE_001
2025-06-16 11:51:38,876 - app.api.websocket_handler - INFO - Setup complete for TEST_DEVICE_001. Ready for Greetings and Family!
2025-06-16 11:51:46,619 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected (disconnect message)
2025-06-16 11:51:46,619 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 11:51:46,619 - app.api.websocket_handler - INFO - Total conversation time for TEST_DEVICE_001: 0.0 seconds
2025-06-16 11:51:46,619 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 11:51:46,619 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 11:51:46,727 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 11:51:46,727 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 11:51:46,727 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 11:51:46,727 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 11:51:46,727 - app.main - INFO - Shutdown complete
2025-06-16 11:51:59,597 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:51:59,597 - app.main - INFO - Initializing managers...
2025-06-16 11:51:59,597 - app.main - INFO -   Initializing database manager...
2025-06-16 11:51:59,597 - app.models.database - INFO - Initializing database...
2025-06-16 11:51:59,643 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:51:59,645 - app.models.database - INFO - Database initialization completed
2025-06-16 11:51:59,645 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:51:59,646 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:51:59,646 - app.main - INFO -   Initializing content manager...
2025-06-16 11:51:59,688 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:51:59,688 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:51:59,688 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:51:59,689 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:51:59,689 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:51:59,689 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:51:59,689 - app.api.websocket_handler - INFO - WebSocketHandler initialized
2025-06-16 11:51:59,689 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 11:51:59,689 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 11:51:59,689 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 11:51:59,689 - app.main - INFO -   All managers initialized successfully
2025-06-16 11:51:59,689 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 11:51:59,689 - app.main - INFO -   Including API routers...
2025-06-16 11:51:59,711 - app.main - INFO - System startup complete - ready to accept connections
2025-06-16 11:51:59,713 - app.managers.cache_manager - INFO - Initializing Redis connection...
2025-06-16 11:51:59,713 - app.managers.cache_manager - INFO - Using fallback in-memory cache (mock_redis=True)
2025-06-16 11:51:59,713 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 11:51:59,714 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 11:51:59,714 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 11:51:59,748 - app.api.websocket_handler - INFO - User initialized: bb70a4f5-40ad-4c1b-b562-72c714add385 for device TEST_DEVICE_001
2025-06-16 11:51:59,748 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 11:52:01,103 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 11:52:01,104 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 11:52:01,104 - app.api.websocket_handler - INFO - Next episode for TEST_DEVICE_001: Greetings and Family (S1E1)
2025-06-16 11:52:01,104 - app.api.websocket_handler - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:52:01,104 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:52:02,216 - app.managers.realtime_manager - INFO - Connected to OpenAI Realtime API for TEST_DEVICE_001
2025-06-16 11:52:02,217 - app.managers.realtime_manager - INFO - Starting OpenAI listener for TEST_DEVICE_001
2025-06-16 11:52:02,217 - app.managers.realtime_manager - ERROR - Error in OpenAI listener for TEST_DEVICE_001: cannot call recv while another coroutine is already waiting for the next message
2025-06-16 11:52:02,217 - app.managers.realtime_manager - INFO - Cleaned up OpenAI connection for TEST_DEVICE_001
2025-06-16 11:52:02,229 - app.managers.realtime_manager - INFO - Session created for TEST_DEVICE_001: sess_BixWB1H6SXy0RwnFz6De1
2025-06-16 11:52:04,257 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 11:52:04,257 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 11:52:04,257 - app.api.websocket_handler - INFO - Generated choice config for TEST_DEVICE_001 with episode: Greetings and Family
2025-06-16 11:52:04,257 - app.managers.realtime_manager - ERROR - No connection found for TEST_DEVICE_001
2025-06-16 11:52:06,271 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:52:06,271 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:52:06,271 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:52:06,272 - app.managers.realtime_manager - INFO - Response creation requested for TEST_DEVICE_001
2025-06-16 11:52:06,272 - app.managers.realtime_manager - INFO - Conversation started for TEST_DEVICE_001
2025-06-16 11:52:06,272 - app.api.websocket_handler - INFO - Setup complete for TEST_DEVICE_001. Ready for Greetings and Family!
2025-06-16 11:52:15,611 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected (disconnect message)
2025-06-16 11:52:15,611 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 11:52:15,611 - app.api.websocket_handler - INFO - Total conversation time for TEST_DEVICE_001: 0.0 seconds
2025-06-16 11:52:15,611 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 11:52:15,611 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 11:52:15,721 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 11:52:15,722 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 11:52:15,722 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 11:52:15,722 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 11:52:15,722 - app.main - INFO - Shutdown complete
2025-06-16 11:52:29,592 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:52:29,593 - app.main - INFO - Initializing managers...
2025-06-16 11:52:29,593 - app.main - INFO -   Initializing database manager...
2025-06-16 11:52:29,593 - app.models.database - INFO - Initializing database...
2025-06-16 11:52:29,650 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:52:29,650 - app.models.database - INFO - Database initialization completed
2025-06-16 11:52:29,651 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:52:29,651 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:52:29,651 - app.main - INFO -   Initializing content manager...
2025-06-16 11:52:29,697 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:52:29,697 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:52:29,697 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:52:29,697 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:52:29,697 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:52:29,697 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:52:29,697 - app.api.websocket_handler - INFO - WebSocketHandler initialized
2025-06-16 11:52:29,697 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 11:52:29,697 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 11:52:29,698 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 11:52:29,698 - app.main - INFO -   All managers initialized successfully
2025-06-16 11:52:29,698 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 11:52:29,698 - app.main - INFO -   Including API routers...
2025-06-16 11:52:29,717 - app.main - INFO - System startup complete - ready to accept connections
2025-06-16 11:52:29,719 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 11:52:29,719 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 11:52:29,719 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 11:52:29,758 - app.api.websocket_handler - INFO - User initialized: bb70a4f5-40ad-4c1b-b562-72c714add385 for device TEST_DEVICE_001
2025-06-16 11:52:29,759 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 11:52:31,278 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 11:52:31,278 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 11:52:31,278 - app.api.websocket_handler - INFO - Next episode for TEST_DEVICE_001: Greetings and Family (S1E1)
2025-06-16 11:52:31,279 - app.managers.cache_manager - INFO - Initializing Redis connection...
2025-06-16 11:52:31,279 - app.managers.cache_manager - INFO - Using fallback in-memory cache (mock_redis=True)
2025-06-16 11:52:31,279 - app.api.websocket_handler - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:52:31,279 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:52:32,515 - app.managers.realtime_manager - INFO - Connected to OpenAI Realtime API for TEST_DEVICE_001
2025-06-16 11:52:32,515 - app.managers.realtime_manager - INFO - Starting OpenAI listener for TEST_DEVICE_001
2025-06-16 11:52:32,516 - app.managers.realtime_manager - ERROR - Error in OpenAI listener for TEST_DEVICE_001: cannot call recv while another coroutine is already waiting for the next message
2025-06-16 11:52:32,516 - app.managers.realtime_manager - INFO - Cleaned up OpenAI connection for TEST_DEVICE_001
2025-06-16 11:52:32,527 - app.managers.realtime_manager - INFO - Session created for TEST_DEVICE_001: sess_BixWg4xRm1B8gbXO3tbbU
2025-06-16 11:52:34,525 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 11:52:34,525 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 11:52:34,525 - app.api.websocket_handler - INFO - Generated choice config for TEST_DEVICE_001 with episode: Greetings and Family
2025-06-16 11:52:34,525 - app.managers.realtime_manager - ERROR - No connection found for TEST_DEVICE_001
2025-06-16 11:52:36,568 - app.api.websocket_handler - ERROR - Error sending to TEST_DEVICE_001: sent 1012 (service restart); no close frame received
2025-06-16 11:52:36,568 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 11:52:36,568 - app.api.websocket_handler - INFO - Total conversation time for TEST_DEVICE_001: 0.0 seconds
2025-06-16 11:52:36,568 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 11:52:36,569 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 11:52:36,569 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:52:36,569 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:52:36,569 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:52:36,569 - app.managers.realtime_manager - INFO - Response creation requested for TEST_DEVICE_001
2025-06-16 11:52:36,569 - app.managers.realtime_manager - INFO - Conversation started for TEST_DEVICE_001
2025-06-16 11:52:36,569 - app.api.websocket_handler - INFO - Setup complete for TEST_DEVICE_001. Ready for Greetings and Family!
2025-06-16 11:52:36,569 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected (disconnect message)
2025-06-16 11:52:36,570 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 11:52:36,570 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 11:52:36,636 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 11:52:36,636 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 11:52:36,636 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 11:52:36,636 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 11:52:36,636 - app.main - INFO - Shutdown complete
2025-06-16 11:52:50,114 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:52:50,114 - app.main - INFO - Initializing managers...
2025-06-16 11:52:50,115 - app.main - INFO -   Initializing database manager...
2025-06-16 11:52:50,115 - app.models.database - INFO - Initializing database...
2025-06-16 11:52:50,161 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:52:50,162 - app.models.database - INFO - Database initialization completed
2025-06-16 11:52:50,162 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:52:50,163 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:52:50,163 - app.main - INFO -   Initializing content manager...
2025-06-16 11:52:50,208 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:52:50,208 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:52:50,208 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:52:50,209 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:52:50,209 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:52:50,209 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:52:50,209 - app.api.websocket_handler - INFO - WebSocketHandler initialized
2025-06-16 11:52:50,209 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 11:52:50,209 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 11:52:50,209 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 11:52:50,209 - app.main - INFO -   All managers initialized successfully
2025-06-16 11:52:50,209 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 11:52:50,209 - app.main - INFO -   Including API routers...
2025-06-16 11:52:50,232 - app.main - INFO - System startup complete - ready to accept connections
2025-06-16 11:52:50,243 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 11:52:50,243 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 11:52:50,243 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 11:52:50,273 - app.api.websocket_handler - INFO - User initialized: bb70a4f5-40ad-4c1b-b562-72c714add385 for device TEST_DEVICE_001
2025-06-16 11:52:50,274 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 11:52:52,904 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 11:52:52,905 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 11:52:52,905 - app.api.websocket_handler - INFO - Next episode for TEST_DEVICE_001: Greetings and Family (S1E1)
2025-06-16 11:52:52,906 - app.managers.cache_manager - INFO - Initializing Redis connection...
2025-06-16 11:52:52,906 - app.managers.cache_manager - INFO - Using fallback in-memory cache (mock_redis=True)
2025-06-16 11:52:52,906 - app.api.websocket_handler - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:52:52,906 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:52:54,319 - app.managers.realtime_manager - INFO - Connected to OpenAI Realtime API for TEST_DEVICE_001
2025-06-16 11:52:54,320 - app.managers.realtime_manager - INFO - Starting OpenAI listener for TEST_DEVICE_001
2025-06-16 11:52:54,320 - app.managers.realtime_manager - ERROR - Error in OpenAI listener for TEST_DEVICE_001: cannot call recv while another coroutine is already waiting for the next message
2025-06-16 11:52:54,320 - app.managers.realtime_manager - INFO - Cleaned up OpenAI connection for TEST_DEVICE_001
2025-06-16 11:52:54,326 - app.managers.realtime_manager - INFO - Session created for TEST_DEVICE_001: sess_BixX1RZn8Yg9Br5pAZFlw
2025-06-16 11:52:56,333 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 11:52:56,333 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 11:52:56,334 - app.api.websocket_handler - INFO - Generated choice config for TEST_DEVICE_001 with episode: Greetings and Family
2025-06-16 11:52:56,334 - app.managers.realtime_manager - ERROR - No connection found for TEST_DEVICE_001
2025-06-16 11:52:58,385 - app.api.websocket_handler - ERROR - Error sending to TEST_DEVICE_001: sent 1012 (service restart); no close frame received
2025-06-16 11:52:58,386 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 11:52:58,386 - app.api.websocket_handler - INFO - Total conversation time for TEST_DEVICE_001: 0.0 seconds
2025-06-16 11:52:58,386 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 11:52:58,386 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 11:52:58,386 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:52:58,386 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:52:58,386 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:52:58,387 - app.managers.realtime_manager - INFO - Response creation requested for TEST_DEVICE_001
2025-06-16 11:52:58,387 - app.managers.realtime_manager - INFO - Conversation started for TEST_DEVICE_001
2025-06-16 11:52:58,387 - app.api.websocket_handler - INFO - Setup complete for TEST_DEVICE_001. Ready for Greetings and Family!
2025-06-16 11:52:58,387 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected (disconnect message)
2025-06-16 11:52:58,387 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 11:52:58,387 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 11:52:58,444 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 11:52:58,444 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 11:52:58,444 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 11:52:58,444 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 11:52:58,444 - app.main - INFO - Shutdown complete
2025-06-16 11:53:12,063 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:53:12,063 - app.main - INFO - Initializing managers...
2025-06-16 11:53:12,063 - app.main - INFO -   Initializing database manager...
2025-06-16 11:53:12,063 - app.models.database - INFO - Initializing database...
2025-06-16 11:53:12,116 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:53:12,116 - app.models.database - INFO - Database initialization completed
2025-06-16 11:53:12,117 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:53:12,117 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:53:12,117 - app.main - INFO -   Initializing content manager...
2025-06-16 11:53:12,167 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:53:12,168 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:53:12,168 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:53:12,168 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:53:12,168 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:53:12,169 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:53:12,170 - app.main - ERROR -   Failed to initialize managers: No module named 'app.managers.conversation_flow_manager'
2025-06-16 11:53:12,170 - app.main - ERROR - Startup failed: No module named 'app.managers.conversation_flow_manager'
2025-06-16 11:53:15,490 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:53:15,490 - app.main - INFO - Initializing managers...
2025-06-16 11:53:15,491 - app.main - INFO -   Initializing database manager...
2025-06-16 11:53:15,491 - app.models.database - INFO - Initializing database...
2025-06-16 11:53:15,528 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:53:15,528 - app.models.database - INFO - Database initialization completed
2025-06-16 11:53:15,529 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:53:15,529 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:53:15,529 - app.main - INFO -   Initializing content manager...
2025-06-16 11:53:15,569 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:53:15,569 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:53:15,569 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:53:15,569 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:53:15,569 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:53:15,570 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:53:15,570 - app.main - ERROR -   Failed to initialize managers: No module named 'app.managers.conversation_flow_manager'
2025-06-16 11:53:15,570 - app.main - ERROR - Startup failed: No module named 'app.managers.conversation_flow_manager'
2025-06-16 11:55:21,410 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:55:21,410 - app.main - INFO - Initializing managers...
2025-06-16 11:55:21,410 - app.main - INFO -   Initializing database manager...
2025-06-16 11:55:21,410 - app.models.database - INFO - Initializing database...
2025-06-16 11:55:21,442 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:55:21,442 - app.models.database - INFO - Database initialization completed
2025-06-16 11:55:21,443 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:55:21,443 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:55:21,443 - app.main - INFO -   Initializing content manager...
2025-06-16 11:55:21,479 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:55:21,479 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:55:21,479 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:55:21,479 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:55:21,479 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:55:21,479 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:55:21,480 - app.main - ERROR -   Failed to initialize managers: No module named 'app.managers.conversation_flow_manager'
2025-06-16 11:55:21,480 - app.main - ERROR - Startup failed: No module named 'app.managers.conversation_flow_manager'
2025-06-16 11:55:39,089 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 11:55:39,090 - app.main - INFO - Initializing managers...
2025-06-16 11:55:39,090 - app.main - INFO -   Initializing database manager...
2025-06-16 11:55:39,090 - app.models.database - INFO - Initializing database...
2025-06-16 11:55:39,147 - app.models.database - INFO - Database tables created successfully
2025-06-16 11:55:39,150 - app.models.database - INFO - Database initialization completed
2025-06-16 11:55:39,150 - app.main - INFO -   Initializing cache manager...
2025-06-16 11:55:39,150 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 11:55:39,150 - app.main - INFO -   Initializing content manager...
2025-06-16 11:55:39,191 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 11:55:39,191 - app.main - INFO -   Initializing realtime manager...
2025-06-16 11:55:39,191 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 11:55:39,191 - app.main - INFO -   Initializing metrics manager...
2025-06-16 11:55:39,191 - app.main - INFO -   Initializing profile manager...
2025-06-16 11:55:39,192 - app.main - INFO -   Initializing websocket manager...
2025-06-16 11:55:39,200 - app.managers.conversation_flow_manager - INFO - ConversationFlowManager initialized
2025-06-16 11:55:39,200 - app.api.websocket_handler - INFO - WebSocketHandler initialized with ConversationFlowManager
2025-06-16 11:55:39,200 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 11:55:39,200 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 11:55:39,200 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 11:55:39,200 - app.main - INFO -   All managers initialized successfully
2025-06-16 11:55:39,201 - app.main - INFO -   Multi-user conversation flow system ready
2025-06-16 11:55:39,201 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 11:55:39,201 - app.main - INFO -   Including API routers...
2025-06-16 11:55:39,215 - app.main - INFO - System startup complete - ready to accept multiple user connections
2025-06-16 11:55:49,061 - app.managers.cache_manager - INFO - Initializing Redis connection...
2025-06-16 11:55:49,061 - app.managers.cache_manager - INFO - Using fallback in-memory cache (mock_redis=True)
2025-06-16 11:55:50,350 - app.main - ERROR - Internal server error: 'dict' object is not callable
2025-06-16 11:55:52,325 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 11:55:52,325 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 11:55:52,326 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 11:55:52,326 - app.managers.conversation_flow_manager - INFO - Starting conversation for user TEST_DEVICE_001
2025-06-16 11:55:52,353 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 11:55:53,534 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 11:55:53,535 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 11:55:53,535 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 11:55:54,694 - app.managers.realtime_manager - INFO - Connected to OpenAI Realtime API for TEST_DEVICE_001
2025-06-16 11:55:54,695 - app.managers.realtime_manager - INFO - Starting OpenAI listener for TEST_DEVICE_001
2025-06-16 11:55:54,695 - app.managers.realtime_manager - ERROR - Error in OpenAI listener for TEST_DEVICE_001: cannot call recv while another coroutine is already waiting for the next message
2025-06-16 11:55:54,695 - app.managers.realtime_manager - INFO - Cleaned up OpenAI connection for TEST_DEVICE_001
2025-06-16 11:55:54,708 - app.managers.realtime_manager - INFO - Session created for TEST_DEVICE_001: sess_BixZw6NIVo8HLDAWvO065
2025-06-16 11:55:54,709 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 11:55:54,709 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 11:55:54,709 - app.managers.realtime_manager - ERROR - No connection found for TEST_DEVICE_001
2025-06-16 11:55:54,710 - app.managers.conversation_flow_manager - INFO - Choice agent configured for TEST_DEVICE_001
2025-06-16 11:55:54,734 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:55:54,734 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:55:54,734 - app.managers.realtime_manager - WARNING - No connection found for TEST_DEVICE_001 when sending event
2025-06-16 11:55:54,735 - app.managers.realtime_manager - INFO - Response creation requested for TEST_DEVICE_001
2025-06-16 11:55:54,735 - app.managers.realtime_manager - INFO - Conversation started for TEST_DEVICE_001
2025-06-16 11:55:54,735 - app.managers.conversation_flow_manager - INFO - Conversation started successfully for TEST_DEVICE_001
2025-06-16 11:55:54,735 - app.api.websocket_handler - INFO - Conversation setup complete for TEST_DEVICE_001
2025-06-16 11:56:32,063 - app.api.websocket_handler - WARNING - Unknown message type from ESP32: start_recording
2025-06-16 11:56:33,702 - app.api.websocket_handler - WARNING - Unknown message type from ESP32: start_recording
2025-06-16 11:56:38,295 - app.api.websocket_handler - WARNING - Unknown message type from ESP32: start_recording
2025-06-16 11:56:38,470 - app.api.websocket_handler - WARNING - Unknown message type from ESP32: start_recording
2025-06-16 11:56:40,698 - app.api.websocket_handler - WARNING - Unknown message type from ESP32: audio_data
2025-06-16 11:56:40,800 - app.api.websocket_handler - WARNING - Unknown message type from ESP32: stop_recording
2025-06-16 11:56:59,975 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected (disconnect message)
2025-06-16 11:56:59,975 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 11:56:59,975 - app.managers.conversation_flow_manager - INFO - Ending conversation for TEST_DEVICE_001 - Duration: 67s
2025-06-16 11:56:59,975 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 11:56:59,976 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 11:57:09,692 - app.main - ERROR - Internal server error: 'dict' object is not callable
2025-06-16 11:58:31,550 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 11:58:31,550 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 11:58:31,550 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 11:58:31,550 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 11:58:31,550 - app.main - INFO - Shutdown complete
2025-06-16 12:06:56,220 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 12:06:56,220 - app.main - INFO - Initializing managers...
2025-06-16 12:06:56,220 - app.main - INFO -   Initializing database manager...
2025-06-16 12:06:56,220 - app.models.database - INFO - Initializing database...
2025-06-16 12:06:56,253 - app.models.database - INFO - Database tables created successfully
2025-06-16 12:06:56,254 - app.models.database - INFO - Database initialization completed
2025-06-16 12:06:56,255 - app.main - INFO -   Initializing cache manager...
2025-06-16 12:06:56,255 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 12:06:56,255 - app.main - INFO -   Initializing content manager...
2025-06-16 12:06:56,292 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 12:06:56,292 - app.main - INFO -   Initializing realtime manager...
2025-06-16 12:06:56,292 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 12:06:56,292 - app.main - INFO -   Initializing metrics manager...
2025-06-16 12:06:56,292 - app.main - INFO -   Initializing profile manager...
2025-06-16 12:06:56,292 - app.main - INFO -   Initializing websocket manager...
2025-06-16 12:06:56,317 - app.managers.conversation_flow_manager - INFO - ConversationFlowManager initialized
2025-06-16 12:06:56,318 - app.api.websocket_handler - INFO - WebSocketHandler initialized with ConversationFlowManager
2025-06-16 12:06:56,318 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 12:06:56,318 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 12:06:56,318 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 12:06:56,318 - app.main - INFO -   All managers initialized successfully
2025-06-16 12:06:56,318 - app.main - INFO -   Multi-user conversation flow system ready
2025-06-16 12:06:56,318 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 12:06:56,318 - app.main - INFO -   Including API routers...
2025-06-16 12:06:56,332 - app.main - INFO - System startup complete - ready to accept multiple user connections
2025-06-16 12:06:56,411 - app.managers.cache_manager - INFO - Initializing Redis connection...
2025-06-16 12:06:56,411 - app.managers.cache_manager - INFO - Using fallback in-memory cache (mock_redis=True)
2025-06-16 12:08:49,501 - app.main - ERROR - Internal server error: 'dict' object is not callable
2025-06-16 12:08:53,243 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 12:08:53,243 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 12:08:53,243 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 12:08:53,243 - app.managers.conversation_flow_manager - INFO - Starting conversation for user TEST_DEVICE_001
2025-06-16 12:08:53,272 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 12:08:55,768 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 12:08:55,768 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 12:08:55,768 - app.managers.conversation_flow_manager - INFO - Next episode for TEST_DEVICE_001: Greetings and Family (S1E1)
2025-06-16 12:08:55,768 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 12:08:57,254 - app.managers.realtime_manager - INFO - Connected to OpenAI Realtime API for TEST_DEVICE_001
2025-06-16 12:08:57,255 - app.managers.realtime_manager - INFO - Starting unified message listener for TEST_DEVICE_001
2025-06-16 12:08:57,255 - app.managers.realtime_manager - INFO - Session created for TEST_DEVICE_001: sess_BixmYdFKNZ6vLQtO8ce5C
2025-06-16 12:08:57,361 - app.managers.realtime_manager - INFO - Session ready for TEST_DEVICE_001: sess_BixmYdFKNZ6vLQtO8ce5C
2025-06-16 12:08:57,361 - app.managers.conversation_flow_manager - INFO - OpenAI connection ready for TEST_DEVICE_001: sess_BixmYdFKNZ6vLQtO8ce5C
2025-06-16 12:08:57,362 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 12:08:57,362 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 12:08:57,362 - app.managers.realtime_manager - INFO - Session updated for TEST_DEVICE_001 with voice: alloy
2025-06-16 12:08:57,362 - app.managers.conversation_flow_manager - INFO - Choice agent configured for TEST_DEVICE_001 (attempt 1)
2025-06-16 12:08:57,386 - app.managers.realtime_manager - INFO - Response creation requested for TEST_DEVICE_001
2025-06-16 12:08:57,386 - app.managers.realtime_manager - INFO - Conversation started for TEST_DEVICE_001
2025-06-16 12:08:57,386 - app.managers.conversation_flow_manager - INFO - Conversation started successfully for TEST_DEVICE_001
2025-06-16 12:08:57,386 - app.api.websocket_handler - INFO - Conversation setup complete for TEST_DEVICE_001
2025-06-16 12:08:57,692 - app.managers.realtime_manager - ERROR - Error in message listener for TEST_DEVICE_001: ConversationFlowManager.start_user_conversation.<locals>.<lambda>() takes 1 positional argument but 2 were given
2025-06-16 12:08:57,692 - app.managers.realtime_manager - INFO - Cleaned up OpenAI connection for TEST_DEVICE_001
2025-06-16 12:12:30,522 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 12:12:30,522 - app.main - INFO - Initializing managers...
2025-06-16 12:12:30,522 - app.main - INFO -   Initializing database manager...
2025-06-16 12:12:30,522 - app.models.database - INFO - Initializing database...
2025-06-16 12:12:30,556 - app.models.database - INFO - Database tables created successfully
2025-06-16 12:12:30,556 - app.models.database - INFO - Database initialization completed
2025-06-16 12:12:30,557 - app.main - INFO -   Initializing cache manager...
2025-06-16 12:12:30,557 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 12:12:30,557 - app.main - INFO -   Initializing content manager...
2025-06-16 12:12:30,593 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 12:12:30,594 - app.main - INFO -   Initializing realtime manager...
2025-06-16 12:12:30,594 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 12:12:30,594 - app.main - INFO -   Initializing metrics manager...
2025-06-16 12:12:30,594 - app.main - INFO -   Initializing profile manager...
2025-06-16 12:12:30,594 - app.main - INFO -   Initializing websocket manager...
2025-06-16 12:12:30,618 - app.managers.conversation_flow_manager - INFO - ConversationFlowManager initialized
2025-06-16 12:12:30,618 - app.api.websocket_handler - INFO - WebSocketHandler initialized with ConversationFlowManager
2025-06-16 12:12:30,618 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 12:12:30,618 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 12:12:30,619 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 12:12:30,619 - app.main - INFO -   All managers initialized successfully
2025-06-16 12:12:30,619 - app.main - INFO -   Multi-user conversation flow system ready
2025-06-16 12:12:30,619 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 12:12:30,619 - app.main - INFO -   Including API routers...
2025-06-16 12:12:30,631 - app.main - INFO - System startup complete - ready to accept multiple user connections
2025-06-16 12:12:36,183 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected (disconnect message)
2025-06-16 12:12:36,183 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 12:12:36,183 - app.managers.conversation_flow_manager - INFO - Ending conversation for TEST_DEVICE_001 - Duration: 222s
2025-06-16 12:12:36,184 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 12:12:36,184 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 12:12:36,243 - app.main - ERROR - Internal server error: 'dict' object is not callable
2025-06-16 12:12:38,074 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 12:12:38,074 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 12:12:38,074 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 12:12:38,074 - app.managers.conversation_flow_manager - INFO - Starting conversation for user TEST_DEVICE_001
2025-06-16 12:12:38,086 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 12:12:39,944 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 12:12:39,944 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 12:12:39,944 - app.managers.conversation_flow_manager - INFO - Next episode for TEST_DEVICE_001: Greetings and Family (S1E1)
2025-06-16 12:12:39,945 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 12:12:41,246 - app.managers.realtime_manager - INFO - Connected to OpenAI Realtime API for TEST_DEVICE_001
2025-06-16 12:12:41,246 - app.managers.realtime_manager - INFO - Starting unified message listener for TEST_DEVICE_001
2025-06-16 12:12:41,257 - app.managers.realtime_manager - INFO - Session created for TEST_DEVICE_001: sess_BixqAKCK0dfAXd5AxNN85
2025-06-16 12:12:41,370 - app.managers.realtime_manager - INFO - Session ready for TEST_DEVICE_001: sess_BixqAKCK0dfAXd5AxNN85
2025-06-16 12:12:41,370 - app.managers.conversation_flow_manager - INFO - OpenAI connection ready for TEST_DEVICE_001: sess_BixqAKCK0dfAXd5AxNN85
2025-06-16 12:12:41,370 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 12:12:41,370 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 12:12:41,370 - app.managers.realtime_manager - INFO - Session updated for TEST_DEVICE_001 with voice: alloy
2025-06-16 12:12:41,371 - app.managers.conversation_flow_manager - INFO - Choice agent configured for TEST_DEVICE_001 (attempt 1)
2025-06-16 12:12:41,389 - app.managers.realtime_manager - INFO - Response creation requested for TEST_DEVICE_001
2025-06-16 12:12:41,389 - app.managers.realtime_manager - INFO - Conversation started for TEST_DEVICE_001
2025-06-16 12:12:41,389 - app.managers.conversation_flow_manager - INFO - Conversation started successfully for TEST_DEVICE_001
2025-06-16 12:12:41,390 - app.api.websocket_handler - INFO - Conversation setup complete for TEST_DEVICE_001
2025-06-16 12:12:41,684 - app.managers.realtime_manager - ERROR - Error in message listener for TEST_DEVICE_001: ConversationFlowManager.start_user_conversation.<locals>.<lambda>() takes 1 positional argument but 2 were given
2025-06-16 12:12:41,684 - app.managers.realtime_manager - INFO - Cleaned up OpenAI connection for TEST_DEVICE_001
2025-06-16 12:12:48,220 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected (disconnect message)
2025-06-16 12:12:48,220 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 12:12:48,221 - app.managers.conversation_flow_manager - INFO - Ending conversation for TEST_DEVICE_001 - Duration: 10s
2025-06-16 12:12:48,221 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 12:12:48,221 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 12:12:50,217 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 12:12:50,217 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 12:12:50,217 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 12:12:50,217 - app.managers.conversation_flow_manager - INFO - Starting conversation for user TEST_DEVICE_001
2025-06-16 12:12:50,229 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 12:12:50,630 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 12:12:50,630 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 12:12:50,630 - app.managers.conversation_flow_manager - INFO - Next episode for TEST_DEVICE_001: Greetings and Family (S1E1)
2025-06-16 12:12:50,630 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 12:12:51,909 - app.managers.realtime_manager - INFO - Connected to OpenAI Realtime API for TEST_DEVICE_001
2025-06-16 12:12:51,909 - app.managers.realtime_manager - INFO - Starting unified message listener for TEST_DEVICE_001
2025-06-16 12:12:51,913 - app.managers.realtime_manager - INFO - Session created for TEST_DEVICE_001: sess_BixqL1hymE42SYNs0POpT
2025-06-16 12:12:52,002 - app.managers.realtime_manager - INFO - Session ready for TEST_DEVICE_001: sess_BixqL1hymE42SYNs0POpT
2025-06-16 12:12:52,002 - app.managers.conversation_flow_manager - INFO - OpenAI connection ready for TEST_DEVICE_001: sess_BixqL1hymE42SYNs0POpT
2025-06-16 12:12:52,002 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 12:12:52,002 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 12:12:52,002 - app.managers.realtime_manager - INFO - Session updated for TEST_DEVICE_001 with voice: alloy
2025-06-16 12:12:52,003 - app.managers.conversation_flow_manager - INFO - Choice agent configured for TEST_DEVICE_001 (attempt 1)
2025-06-16 12:12:52,020 - app.managers.realtime_manager - INFO - Response creation requested for TEST_DEVICE_001
2025-06-16 12:12:52,020 - app.managers.realtime_manager - INFO - Conversation started for TEST_DEVICE_001
2025-06-16 12:12:52,020 - app.managers.conversation_flow_manager - INFO - Conversation started successfully for TEST_DEVICE_001
2025-06-16 12:12:52,020 - app.api.websocket_handler - INFO - Conversation setup complete for TEST_DEVICE_001
2025-06-16 12:12:52,328 - app.managers.realtime_manager - ERROR - Error in message listener for TEST_DEVICE_001: ConversationFlowManager.start_user_conversation.<locals>.<lambda>() takes 1 positional argument but 2 were given
2025-06-16 12:12:52,328 - app.managers.realtime_manager - INFO - Cleaned up OpenAI connection for TEST_DEVICE_001
2025-06-16 12:12:58,762 - app.main - ERROR - Internal server error: 'dict' object is not callable
2025-06-16 12:13:00,175 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected (disconnect message)
2025-06-16 12:13:00,175 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 12:13:00,175 - app.managers.conversation_flow_manager - INFO - Ending conversation for TEST_DEVICE_001 - Duration: 9s
2025-06-16 12:13:00,175 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 12:13:00,176 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 12:13:01,589 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 12:13:01,589 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 12:13:01,589 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 12:13:01,589 - app.managers.conversation_flow_manager - INFO - Starting conversation for user TEST_DEVICE_001
2025-06-16 12:13:01,601 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 12:13:01,947 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 12:13:01,947 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 12:13:01,948 - app.managers.conversation_flow_manager - INFO - Next episode for TEST_DEVICE_001: Greetings and Family (S1E1)
2025-06-16 12:13:01,949 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 12:13:03,031 - app.managers.realtime_manager - INFO - Connected to OpenAI Realtime API for TEST_DEVICE_001
2025-06-16 12:13:03,031 - app.managers.realtime_manager - INFO - Starting unified message listener for TEST_DEVICE_001
2025-06-16 12:13:03,047 - app.managers.realtime_manager - INFO - Session created for TEST_DEVICE_001: sess_BixqWKRQ2Zkc92psTlmEZ
2025-06-16 12:13:03,139 - app.managers.realtime_manager - INFO - Session ready for TEST_DEVICE_001: sess_BixqWKRQ2Zkc92psTlmEZ
2025-06-16 12:13:03,139 - app.managers.conversation_flow_manager - INFO - OpenAI connection ready for TEST_DEVICE_001: sess_BixqWKRQ2Zkc92psTlmEZ
2025-06-16 12:13:03,139 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 12:13:03,140 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 12:13:03,140 - app.managers.realtime_manager - INFO - Session updated for TEST_DEVICE_001 with voice: alloy
2025-06-16 12:13:03,140 - app.managers.conversation_flow_manager - INFO - Choice agent configured for TEST_DEVICE_001 (attempt 1)
2025-06-16 12:13:03,156 - app.managers.realtime_manager - INFO - Response creation requested for TEST_DEVICE_001
2025-06-16 12:13:03,156 - app.managers.realtime_manager - INFO - Conversation started for TEST_DEVICE_001
2025-06-16 12:13:03,156 - app.managers.conversation_flow_manager - INFO - Conversation started successfully for TEST_DEVICE_001
2025-06-16 12:13:03,156 - app.api.websocket_handler - INFO - Conversation setup complete for TEST_DEVICE_001
2025-06-16 12:13:03,414 - app.managers.realtime_manager - ERROR - Error in message listener for TEST_DEVICE_001: ConversationFlowManager.start_user_conversation.<locals>.<lambda>() takes 1 positional argument but 2 were given
2025-06-16 12:13:03,414 - app.managers.realtime_manager - INFO - Cleaned up OpenAI connection for TEST_DEVICE_001
2025-06-16 12:13:37,198 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected (disconnect message)
2025-06-16 12:13:37,198 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 12:13:37,198 - app.managers.conversation_flow_manager - INFO - Ending conversation for TEST_DEVICE_001 - Duration: 35s
2025-06-16 12:13:37,198 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 12:13:37,199 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 12:13:54,339 - app.main - INFO - New connection attempt from ESP32: TEST_DEVICE_001
2025-06-16 12:13:54,339 - app.api.websocket_handler - INFO - Handling connection for device ID: TEST_DEVICE_001
2025-06-16 12:13:54,339 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 connected
2025-06-16 12:13:54,339 - app.managers.conversation_flow_manager - INFO - Starting conversation for user TEST_DEVICE_001
2025-06-16 12:13:54,360 - app.managers.content_manager - INFO - Finding next episode for user bb70a4f5-40ad-4c1b-b562-72c714add385: spanish S1E1
2025-06-16 12:13:54,762 - app.managers.content_manager - INFO - Retrieved episode with prompts: spanish_1_1
2025-06-16 12:13:54,762 - app.managers.content_manager - INFO - Next episode found: Greetings and Family for user bb70a4f5-40ad-4c1b-b562-72c714add385
2025-06-16 12:13:54,762 - app.managers.conversation_flow_manager - INFO - Next episode for TEST_DEVICE_001: Greetings and Family (S1E1)
2025-06-16 12:13:54,762 - app.managers.realtime_manager - INFO - Creating OpenAI Realtime connection for TEST_DEVICE_001
2025-06-16 12:13:56,006 - app.managers.realtime_manager - INFO - Connected to OpenAI Realtime API for TEST_DEVICE_001
2025-06-16 12:13:56,006 - app.managers.realtime_manager - INFO - Starting unified message listener for TEST_DEVICE_001
2025-06-16 12:13:56,008 - app.managers.realtime_manager - INFO - Session created for TEST_DEVICE_001: sess_BixrNuZy6mzc8cWLQCzfW
2025-06-16 12:13:56,098 - app.managers.realtime_manager - INFO - Session ready for TEST_DEVICE_001: sess_BixrNuZy6mzc8cWLQCzfW
2025-06-16 12:13:56,098 - app.managers.conversation_flow_manager - INFO - OpenAI connection ready for TEST_DEVICE_001: sess_BixrNuZy6mzc8cWLQCzfW
2025-06-16 12:13:56,098 - app.agents.agent_configs - INFO - Creating choice agent config for next episode: Greetings and Family
2025-06-16 12:13:56,098 - app.agents.agent_configs - INFO - Choice agent config created for friend, age 6
2025-06-16 12:13:56,098 - app.managers.realtime_manager - INFO - Session updated for TEST_DEVICE_001 with voice: alloy
2025-06-16 12:13:56,098 - app.managers.conversation_flow_manager - INFO - Choice agent configured for TEST_DEVICE_001 (attempt 1)
2025-06-16 12:13:56,114 - app.managers.realtime_manager - INFO - Response creation requested for TEST_DEVICE_001
2025-06-16 12:13:56,115 - app.managers.realtime_manager - INFO - Conversation started for TEST_DEVICE_001
2025-06-16 12:13:56,115 - app.managers.conversation_flow_manager - INFO - Conversation started successfully for TEST_DEVICE_001
2025-06-16 12:13:56,115 - app.api.websocket_handler - INFO - Conversation setup complete for TEST_DEVICE_001
2025-06-16 12:13:56,406 - app.managers.realtime_manager - ERROR - Error in message listener for TEST_DEVICE_001: ConversationFlowManager.start_user_conversation.<locals>.<lambda>() takes 1 positional argument but 2 were given
2025-06-16 12:13:56,406 - app.managers.realtime_manager - INFO - Cleaned up OpenAI connection for TEST_DEVICE_001
2025-06-16 12:13:56,809 - app.api.websocket_handler - WARNING - Unknown message type from ESP32: start_recording
2025-06-16 12:14:03,889 - app.api.websocket_handler - WARNING - Unknown message type from ESP32: stop_recording
2025-06-16 12:14:05,759 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected (disconnect message)
2025-06-16 12:14:05,759 - app.api.websocket_handler - INFO - Cleaning up connection for TEST_DEVICE_001
2025-06-16 12:14:05,759 - app.managers.conversation_flow_manager - INFO - Ending conversation for TEST_DEVICE_001 - Duration: 11s
2025-06-16 12:14:05,759 - app.api.websocket_handler - INFO - ESP32 TEST_DEVICE_001 disconnected
2025-06-16 12:14:05,759 - app.api.websocket_handler - INFO - Cleanup completed for TEST_DEVICE_001
2025-06-16 12:14:05,811 - app.main - ERROR - Internal server error: 'dict' object is not callable
2025-06-16 12:17:29,100 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 12:17:29,100 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 12:17:29,100 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 12:17:29,100 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 12:17:29,100 - app.main - INFO - Shutdown complete
2025-06-16 12:17:29,116 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 12:17:29,116 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 12:17:29,117 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 12:17:29,117 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 12:17:29,117 - app.main - INFO - Shutdown complete
2025-06-16 12:17:51,836 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 12:17:51,836 - app.main - INFO - Initializing managers...
2025-06-16 12:17:51,836 - app.main - INFO -   Initializing database manager...
2025-06-16 12:17:51,836 - app.models.database - INFO - Initializing database...
2025-06-16 12:17:51,870 - app.models.database - INFO - Database tables created successfully
2025-06-16 12:17:51,871 - app.models.database - INFO - Database initialization completed
2025-06-16 12:17:51,871 - app.main - INFO -   Initializing cache manager...
2025-06-16 12:17:51,871 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 12:17:51,871 - app.main - INFO -   Initializing content manager...
2025-06-16 12:17:51,911 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 12:17:51,911 - app.main - INFO -   Initializing realtime manager...
2025-06-16 12:17:51,911 - app.managers.realtime_manager - INFO - RealtimeManager initialized
2025-06-16 12:17:51,911 - app.main - INFO -   Initializing metrics manager...
2025-06-16 12:17:51,912 - app.main - INFO -   Initializing profile manager...
2025-06-16 12:17:51,912 - app.main - INFO -   Initializing websocket manager...
2025-06-16 12:17:51,913 - app.managers.conversation_flow_manager - INFO - ConversationFlowManager initialized
2025-06-16 12:17:51,913 - app.api.websocket_handler - INFO - WebSocketHandler initialized with ConversationFlowManager
2025-06-16 12:17:51,913 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 12:17:51,913 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 12:17:51,913 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 12:17:51,913 - app.main - INFO -   All managers initialized successfully
2025-06-16 12:17:51,913 - app.main - INFO -   Multi-user conversation flow system ready
2025-06-16 12:17:51,913 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 12:17:51,913 - app.main - INFO -   Including API routers...
2025-06-16 12:17:51,929 - app.main - INFO - System startup complete - ready to accept multiple user connections
2025-06-16 12:17:55,110 - app.managers.cache_manager - INFO - Initializing Redis connection...
2025-06-16 12:17:55,112 - app.managers.cache_manager - INFO - Using fallback in-memory cache (mock_redis=True)
2025-06-16 12:23:13,635 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 12:23:13,635 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 12:23:13,635 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 12:23:13,635 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 12:23:13,635 - app.main - INFO - Shutdown complete
2025-06-16 12:23:16,295 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 12:23:16,295 - app.main - INFO - Initializing managers...
2025-06-16 12:23:16,295 - app.main - INFO -   Initializing database manager...
2025-06-16 12:23:16,295 - app.models.database - INFO - Initializing database...
2025-06-16 12:23:16,332 - app.models.database - INFO - Database tables created successfully
2025-06-16 12:23:16,333 - app.models.database - INFO - Database initialization completed
2025-06-16 12:23:16,333 - app.main - INFO -   Initializing cache manager...
2025-06-16 12:23:16,333 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 12:23:16,334 - app.main - INFO -   Initializing content manager...
2025-06-16 12:23:16,373 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 12:23:16,373 - app.main - INFO -   Initializing realtime manager...
2025-06-16 12:23:16,373 - app.managers.realtime_manager - INFO - RealtimeManager initialized (Official OpenAI Compliant)
2025-06-16 12:23:16,373 - app.main - INFO -   Initializing metrics manager...
2025-06-16 12:23:16,373 - app.main - INFO -   Initializing profile manager...
2025-06-16 12:23:16,373 - app.main - INFO -   Initializing websocket manager...
2025-06-16 12:23:16,374 - app.managers.conversation_flow_manager - INFO - ConversationFlowManager initialized
2025-06-16 12:23:16,375 - app.api.websocket_handler - INFO - WebSocketHandler initialized with ConversationFlowManager
2025-06-16 12:23:16,375 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 12:23:16,375 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 12:23:16,375 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 12:23:16,375 - app.main - INFO -   All managers initialized successfully
2025-06-16 12:23:16,375 - app.main - INFO -   Multi-user conversation flow system ready
2025-06-16 12:23:16,375 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 12:23:16,375 - app.main - INFO -   Including API routers...
2025-06-16 12:23:16,388 - app.main - INFO - System startup complete - ready to accept multiple user connections
2025-06-16 12:23:34,767 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 12:23:34,767 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 12:23:34,767 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 12:23:34,767 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 12:23:34,767 - app.main - INFO - Shutdown complete
2025-06-16 12:23:37,138 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 12:23:37,139 - app.main - INFO - Initializing managers...
2025-06-16 12:23:37,139 - app.main - INFO -   Initializing database manager...
2025-06-16 12:23:37,139 - app.models.database - INFO - Initializing database...
2025-06-16 12:23:37,178 - app.models.database - INFO - Database tables created successfully
2025-06-16 12:23:37,181 - app.models.database - INFO - Database initialization completed
2025-06-16 12:23:37,181 - app.main - INFO -   Initializing cache manager...
2025-06-16 12:23:37,181 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 12:23:37,182 - app.main - INFO -   Initializing content manager...
2025-06-16 12:23:37,223 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 12:23:37,224 - app.main - INFO -   Initializing realtime manager...
2025-06-16 12:23:37,224 - app.managers.realtime_manager - INFO - RealtimeManager initialized (Official OpenAI Compliant)
2025-06-16 12:23:37,224 - app.main - INFO -   Initializing metrics manager...
2025-06-16 12:23:37,224 - app.main - INFO -   Initializing profile manager...
2025-06-16 12:23:37,224 - app.main - INFO -   Initializing websocket manager...
2025-06-16 12:23:37,225 - app.managers.conversation_flow_manager - INFO - ConversationFlowManager initialized
2025-06-16 12:23:37,225 - app.api.websocket_handler - INFO - WebSocketHandler initialized with ConversationFlowManager
2025-06-16 12:23:37,225 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 12:23:37,225 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 12:23:37,226 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 12:23:37,226 - app.main - INFO -   All managers initialized successfully
2025-06-16 12:23:37,226 - app.main - INFO -   Multi-user conversation flow system ready
2025-06-16 12:23:37,226 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 12:23:37,226 - app.main - INFO -   Including API routers...
2025-06-16 12:23:37,241 - app.main - INFO - System startup complete - ready to accept multiple user connections
2025-06-16 12:23:55,111 - app.managers.cache_manager - INFO - Initializing Redis connection...
2025-06-16 12:23:55,111 - app.managers.cache_manager - INFO - Using fallback in-memory cache (mock_redis=True)
2025-06-16 12:24:09,329 - app.main - INFO - ESP32 Language Learning System shutting down...
2025-06-16 12:24:09,329 - app.managers.cache_manager - INFO - Fallback cache cleaned up
2025-06-16 12:24:09,329 - app.managers.realtime_manager - INFO - Cleaning up all realtime connections
2025-06-16 12:24:09,329 - app.managers.realtime_manager - INFO - All realtime connections cleaned up
2025-06-16 12:24:09,329 - app.main - INFO - Shutdown complete
2025-06-16 12:24:11,865 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 12:24:11,865 - app.main - INFO - Initializing managers...
2025-06-16 12:24:11,865 - app.main - INFO -   Initializing database manager...
2025-06-16 12:24:11,865 - app.models.database - INFO - Initializing database...
2025-06-16 12:24:11,899 - app.models.database - INFO - Database tables created successfully
2025-06-16 12:24:11,900 - app.models.database - INFO - Database initialization completed
2025-06-16 12:24:11,900 - app.main - INFO -   Initializing cache manager...
2025-06-16 12:24:11,901 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 12:24:11,901 - app.main - INFO -   Initializing content manager...
2025-06-16 12:24:11,940 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 12:24:11,940 - app.main - INFO -   Initializing realtime manager...
2025-06-16 12:24:11,940 - app.managers.realtime_manager - INFO - RealtimeManager initialized (Official OpenAI Compliant)
2025-06-16 12:24:11,940 - app.main - INFO -   Initializing metrics manager...
2025-06-16 12:24:11,940 - app.main - INFO -   Initializing profile manager...
2025-06-16 12:24:11,940 - app.main - INFO -   Initializing websocket manager...
2025-06-16 12:24:11,967 - app.managers.conversation_flow_manager - INFO - ConversationFlowManager initialized (Official OpenAI Compliant)
2025-06-16 12:24:11,967 - app.api.websocket_handler - INFO - WebSocketHandler initialized with ConversationFlowManager
2025-06-16 12:24:11,967 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 12:24:11,967 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 12:24:11,967 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 12:24:11,967 - app.main - INFO -   All managers initialized successfully
2025-06-16 12:24:11,967 - app.main - INFO -   Multi-user conversation flow system ready
2025-06-16 12:24:11,967 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 12:24:11,967 - app.main - INFO -   Including API routers...
2025-06-16 12:24:11,982 - app.main - INFO - System startup complete - ready to accept multiple user connections
2025-06-16 12:24:21,305 - app.managers.cache_manager - INFO - Initializing Redis connection...
2025-06-16 12:24:21,305 - app.managers.cache_manager - INFO - Using fallback in-memory cache (mock_redis=True)
2025-06-16 12:24:27,857 - app.main - ERROR - Internal server error: 'dict' object is not callable
2025-06-16 12:24:47,174 - app.main - INFO - ESP32 Language Learning System starting up...
2025-06-16 12:24:47,174 - app.main - INFO - Initializing managers...
2025-06-16 12:24:47,174 - app.main - INFO -   Initializing database manager...
2025-06-16 12:24:47,174 - app.models.database - INFO - Initializing database...
2025-06-16 12:24:47,205 - app.models.database - INFO - Database tables created successfully
2025-06-16 12:24:47,206 - app.models.database - INFO - Database initialization completed
2025-06-16 12:24:47,206 - app.main - INFO -   Initializing cache manager...
2025-06-16 12:24:47,206 - app.managers.cache_manager - INFO - Cache manager initialized with Redis target: localhost:6379
2025-06-16 12:24:47,206 - app.main - INFO -   Initializing content manager...
2025-06-16 12:24:47,243 - app.managers.content_manager - INFO - Firebase initialized successfully
2025-06-16 12:24:47,244 - app.main - INFO -   Initializing realtime manager...
2025-06-16 12:24:47,244 - app.managers.realtime_manager - INFO - RealtimeManager initialized (Official OpenAI Compliant)
2025-06-16 12:24:47,244 - app.main - INFO -   Initializing metrics manager...
2025-06-16 12:24:47,244 - app.main - INFO -   Initializing profile manager...
2025-06-16 12:24:47,244 - app.main - INFO -   Initializing websocket manager...
2025-06-16 12:24:47,247 - app.managers.conversation_flow_manager - INFO - ConversationFlowManager initialized (Official OpenAI Compliant)
2025-06-16 12:24:47,247 - app.api.websocket_handler - INFO - WebSocketHandler initialized with ConversationFlowManager
2025-06-16 12:24:47,247 - app.main - INFO -   Setting up manager cross-references...
2025-06-16 12:24:47,247 - app.managers.realtime_manager - INFO - WebSocket handler set for RealtimeManager
2025-06-16 12:24:47,247 - app.api.websocket_handler - INFO - Server state set for WebSocketHandler
2025-06-16 12:24:47,247 - app.main - INFO -   All managers initialized successfully
2025-06-16 12:24:47,247 - app.main - INFO -   Multi-user conversation flow system ready
2025-06-16 12:24:47,247 - app.main - INFO -   Setting up API dependency injection...
2025-06-16 12:24:47,247 - app.main - INFO -   Including API routers...
2025-06-16 12:24:47,262 - app.main - INFO - System startup complete - ready to accept multiple user connections
